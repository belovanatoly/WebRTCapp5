<html>
<html>
<head>
<meta charset="utf-8">
<title>user</title>
  <script src="/socket.io/socket.io.js"></script>
  <style>
    video { height: 240px; width: 320px; border: 1px solid grey; }
  </style>
   
</head>

<body>


<p>User</p>

  <button id="btn_getUserMedia" onclick="getUserMedia_click()">getUserMedia</button>
  <button id="btn_newPeerConnection" onclick="newPeerConnection_click()">newPeerConnection</button>
  <button id="btn_createOffer" onclick="createOffer_click()">createOffer</button>
  <button id="btn_AudioOn" onclick="AudioOn_click()">AudioOn</button>
  <button id="btn_AudioOff" onclick="AudioOff_click()">AudioOff</button>
  <br>
  <video id="localVideo"></video>
  <video id="remoteVideo"></video>
  <div id='logs'>&nbsp;</div>
  <div id='connection'>&nbsp;</div>
  <div id='debug'><br>Console:<br></div>
 
  <script type="text/javascript">
    var begin = 'begin 15';
    
    var socket = io.connect();
    var streamConstraints = { "audio": false, "video": true };
var pc = null;
var servers = null;	  

	  
    console.log(begin);
    document.getElementById('debug').innerHTML += begin + '<br>'; 
  
//navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia;
	  
navigator.getUserMedia = (
	navigator.getUserMedia ||
	navigator.webkitGetUserMedia ||
	navigator.mozGetUserMedia ||
	navigator.msGetUserMedia
);
	  
var RTCPeerConnection = (
	RTCPeerConnection ||
	webkitRTCPeerConnection ||
	mozRTCPeerConnection ||
	msRTCPeerConnection
);
	  
//var PeerConnection = window.mozRTCPeerConnection || window.webkitRTCPeerConnection  || RTCPeerConnection;
	  if(!RTCPeerConnection) {document.getElementById('debug').innerHTML += 'Your browser does not support WebRTC<br>';}
	  else {document.getElementById('debug').innerHTML += 'Your browser supports WebRTC<br>';}

	  
pc = new RTCPeerConnection(servers);
	    console.log('pc: ' + pc.iceConnectionState);
	    document.getElementById('debug').innerHTML += pc.iceConnectionState + '<br>';
	  
  function getUserMedia_click() {
  console.log("getUserMedia_click()");
  document.getElementById('debug').innerHTML += 'getUserMedia_click<br>';
  
  navigator.getUserMedia(streamConstraints, getUserMedia_success, getUserMedia_error);
}
    
function getUserMedia_success(stream) {
  document.getElementById('debug').innerHTML += 'getUserMedia_success<br>';
  localVideo.src = URL.createObjectURL(stream); // Подключаем медиапоток к HTML-элементу <video>
//  localVideo1.srcObject = stream;
  localVideo.autoplay = true;
  localVideo.muted = true;
//  localStream = stream; // и сохраняем в глобальной переменной для дальнейшего использования
}

function getUserMedia_error(error) {
  console.log("getUserMedia_error():", error);
document.getElementById('debug').innerHTML += error;
}
///////////////////
	  
function newPeerConnection_click(){
	document.getElementById('logs').innerHTML = "newPeerConnection is clicked<br>";


if (pc) {
	console.log('pc is created');
	document.getElementById('debug').innerHTML += "pc is created<br>";
	console.log(pc);
	} else document.getElementById('debug').innerHTML += "pc is not created<br>";
	
}    
///////////////////
socket.on('success', function ()
{
	console.log("socket.on connected");
	document.getElementById('debug').innerHTML += "socket.on connected<br>";
});

  </script>


  
</body>
</html>
